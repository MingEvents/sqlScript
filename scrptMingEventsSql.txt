create database database_CULTURA_BCN;
use database_CULTURA_BCN
create table Establecimiento(
id_establecimiento int IDENTITY(1,1) PRIMARY KEY,
nombre varchar(50) not null,
direccion varchar(255) not null,
aforo int not null
);


create table rol(
id_rol int IDENTITY(1,1) PRIMARY KEY,
nombre varchar(25) not null
);


create table usuario(
id_usuario int IDENTITY(1,1) PRIMARY KEY,
nombre varchar(50) not null,
apellidos varchar(150) not null,
telefono int not null,
contrasena varchar(MAX) not null,
foto varchar(255),
correo varchar(255) unique not null,
id_rol int not null,
FOREIGN KEY (id_rol) REFERENCES rol(id_rol)
);




create table evento(
id_evento int IDENTITY(1,1) PRIMARY KEY,
nombre varchar(255) not null,
precio int not null,
aforo int not null,
edad_minima int not null,
foto varchar(255),
fecha_inicio date not null,
fecha_fin date,
enumeradas bit not null,
filas int,
columnas int,
descripcion varchar(1000) not null
);



create table butaca(
id_butaca int IDENTITY(1,1) PRIMARY KEY,
columna int not null,
fila int not null,
id_evento int not null,
id_usuario int
FOREIGN KEY (id_evento) REFERENCES evento(id_evento),
FOREIGN KEY (id_usuario) REFERENCES usuario(id_usuario)
);



create table chat (
id_chat int identity(1,1) primary key,
id_emisor int not null,
id_receptor int not null,
fecha_creacion date not null,
FOREIGN KEY (id_emisor) REFERENCES usuario(id_usuario),
FOREIGN KEY (id_receptor) REFERENCES usuario(id_usuario)
);




create table mensaje(
id_mensaje int identity(1,1) primary key,
id_usuario int,
id_chat int,
texto varchar(5000),
fecha_publicacion date,
FOREIGN KEY (id_usuario) REFERENCES usuario(id_usuario),
FOREIGN KEY (id_chat) REFERENCES chat(id_chat)
);




create table reserva_entrada(
id_butaca int,
id_usuario int,
PRIMARY KEY (id_butaca, id_usuario), 
FOREIGN KEY (id_usuario) REFERENCES usuario(id_usuario),
FOREIGN KEY (id_butaca) REFERENCES butaca(id_butaca)
);

